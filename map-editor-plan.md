# 맵 에디터 구성안

## 📋 개요

동물의 숲 스타일 3D 게임을 위한 전용 맵 에디터 개발 계획서입니다. 이 에디터를 통해 게임 맵을 직관적으로 편집하고 관리할 수 있습니다.

---

## 🎯 목표

1. **직관적인 3D 맵 편집**: 드래그 앤 드롭으로 오브젝트 배치
2. **타일 기반 시스템**: 정확한 그리드 배치 지원
3. **맵 데이터 관리**: JSON 형식으로 맵 저장/로드
4. **게임 통합**: 게임에서 맵 데이터를 로드하여 사용

---

## 🏗️ 시스템 구조

### 1. 아키텍처

```
Map Editor (별도 앱/모드)
├── Frontend (React/Vue 또는 순수 HTML+TS)
│   ├── 3D 뷰포트 (Babylon.js)
│   ├── 오브젝트 팔레트
│   ├── 속성 패널
│   ├── 레이어 관리
│   └── 툴바
├── Backend (선택사항)
│   └── 맵 데이터 서버 저장 (미래 확장용)
└── 공유 모듈
    ├── 맵 데이터 스키마 (JSON)
    └── 공통 타입 정의
```

### 2. 프로젝트 구조

```
프로젝트 루트/
├── map-editor/              # 맵 에디터 앱 (별도 디렉토리)
│   ├── src/
│   │   ├── main.ts          # 에디터 진입점
│   │   ├── core/
│   │   │   ├── EditorScene.ts      # 에디터 씬 관리
│   │   │   ├── GridSystem.ts       # 그리드 시스템
│   │   │   ├── SnapSystem.ts       # 스냅 시스템
│   │   │   └── MapManager.ts       # 맵 저장/로드
│   │   ├── ui/
│   │   │   ├── Toolbar.ts          # 툴바 (저장, 로드, 실행 등)
│   │   │   ├── ObjectPalette.ts    # 오브젝트 팔레트
│   │   │   ├── PropertiesPanel.ts  # 속성 패널
│   │   │   ├── LayerPanel.ts       # 레이어 관리
│   │   │   └── Minimap.ts          # 미니맵
│   │   ├── tools/
│   │   │   ├── SelectTool.ts       # 선택 도구
│   │   │   ├── PlaceTool.ts        # 배치 도구
│   │   │   ├── MoveTool.ts         # 이동 도구
│   │   │   ├── RotateTool.ts       # 회전 도구
│   │   │   └── DeleteTool.ts       # 삭제 도구
│   │   └── data/
│   │       ├── MapData.ts           # 맵 데이터 타입
│   │       └── ObjectTemplates.ts   # 오브젝트 템플릿
│   ├── public/
│   │   └── maps/            # 맵 파일 저장 위치
│   └── package.json
├── src/                     # 게임 소스 (기존)
│   └── ...
└── shared/                  # 공유 모듈
    ├── types/
    │   ├── MapData.ts       # 맵 데이터 스키마
    │   └── GameObject.ts    # 게임 오브젝트 타입
    └── utils/
        └── MapLoader.ts     # 맵 로더 (게임에서 사용)
```

---

## 📐 데이터 구조

### 1. 맵 데이터 스키마 (JSON)

```typescript
interface MapData {
  version: string;              // "1.0.0"
  metadata: {
    name: string;               // 맵 이름
    description?: string;        // 맵 설명
    author?: string;             // 제작자
    createdAt: string;           // 생성 날짜 (ISO 8601)
    updatedAt: string;           // 수정 날짜
    size: {
      width: number;             // 맵 너비 (타일 단위)
      height: number;            // 맵 높이 (타일 단위)
      tileSize: number;          // 타일 크기 (기본: 1.0)
    };
  };
  
  // 타일 레이어 (지형)
  terrain: {
    tiles: Array<{
      x: number;                 // 그리드 X 좌표
      z: number;                 // 그리드 Z 좌표
      y?: number;                // 높이 (옵션)
      type: "grass" | "dirt" | "water" | "stone";
      variant?: number;          // 타일 변형 (텍스처 인덱스)
    }>;
  };
  
  // 오브젝트 레이어
  objects: Array<{
    id: string;                  // 고유 ID (UUID)
    type: "tree" | "rock" | "building" | "item" | "npc";
    position: {
      x: number;                 // 월드 X 좌표
      y: number;                 // 월드 Y 좌표 (높이)
      z: number;                 // 월드 Z 좌표
    };
    rotation?: {
      x?: number;                // X축 회전 (라디안)
      y?: number;                // Y축 회전 (라디안)
      z?: number;                // Z축 회전 (라디안)
    };
    scale?: {
      x?: number;                // X축 스케일
      y?: number;                // Y축 스케일
      z?: number;                // Z축 스케일
    };
    properties?: {               // 오브젝트별 속성
      [key: string]: any;
    };
  }>;
  
  // 스폰 포인트
  spawnPoints?: Array<{
    id: string;
    position: { x: number; y: number; z: number };
    type: "player" | "npc";
  }>;
}
```

### 2. 오브젝트 템플릿

```typescript
interface ObjectTemplate {
  id: string;
  name: string;
  category: "nature" | "building" | "decoration" | "interactive";
  type: string;
  model?: {
    path: string;                // GLB/GLTF 경로
    scale?: number;              // 기본 스케일
    rotation?: { x: number; y: number; z: number };
  };
  icon?: string;                 // 팔레트 아이콘
  properties: {
    collidable?: boolean;        // 충돌 가능 여부
    interactive?: boolean;       // 상호작용 가능 여부
    gathering?: {                // 채집 가능한 경우
      type: "wood" | "mineral" | "plant";
      dropTable: string;         // 드롭 테이블 ID
    };
  };
}
```

---

## 🛠️ 핵심 기능

### 1. 타일 편집 시스템

- **그리드 기반 배치**
  - 스냅 기능 (0.5, 1.0 단위)
  - 그리드 표시/숨김 토글
  - 타일 단위 이동 (WASD 또는 화살표 키)

- **타일 종류**
  - 잔디 (기본)
  - 흙
  - 물
  - 돌
  - 모래

### 2. 오브젝트 배치 시스템

- **배치 모드**
  - 단일 배치: 클릭으로 배치
  - 브러시 모드: 드래그로 연속 배치
  - 스마트 배치: 자동 정렬 및 충돌 방지

- **오브젝트 카테고리**
  - 자연: 나무, 바위, 꽃, 덤불
  - 건물: 집, 상점, 작업대
  - 장식: 가로등, 벤치, 펜스
  - 상호작용: 채집 가능 오브젝트

### 3. 선택 및 편집 도구

- **선택 도구**
  - 단일 선택: 클릭
  - 다중 선택: Ctrl+클릭 또는 드래그 박스
  - 그룹 선택: 같은 타입의 오브젝트만

- **이동 도구**
  - 3D 공간에서 이동 (X, Z 평면)
  - 높이 조정 (Y축)
  - 스냅 이동 (그리드에 맞춤)

- **회전 도구**
  - Y축 회전 (15도 단위 또는 자유)
  - 회전 핸들 UI

- **스케일 도구**
  - 균등 스케일
  - 축별 스케일

### 4. 레이어 시스템

- **레이어 관리**
  - 타일 레이어 (지형)
  - 오브젝트 레이어 (자연, 건물, 장식)
  - 각 레이어별 표시/숨김 토글
  - 레이어 순서 변경 (Z-order)

### 5. 카메라 시스템

- **카메라 모드**
  - 탑뷰 (Top-down): 맵 전체 보기
  - 아이소메트릭: 45도 각도 뷰
  - 프리뷰: 게임과 동일한 카메라
  - 프리 캠: 자유 시점

- **카메라 컨트롤**
  - WASD: 이동
  - 마우스 드래그: 회전/팬
  - 휠: 줌 인/아웃
  - Home 키: 맵 중앙으로 이동

### 6. 미니맵

- **기능**
  - 맵 전체 개요 표시
  - 현재 뷰포트 표시
  - 클릭으로 해당 위치로 이동
  - 오브젝트 위치 표시 (옵션)

### 7. 맵 저장/로드

- **저장**
  - JSON 형식으로 저장
  - 압축 옵션 (선택)
  - 버전 관리
  - 미리보기 이미지 자동 생성

- **로드**
  - 맵 목록 표시
  - 검색 및 필터링
  - 최근 사용 맵

### 8. 게임 실행 (미리보기)

- **인게임 미리보기**
  - 현재 편집 중인 맵을 게임에서 즉시 실행
  - 새 탭/창에서 열기
  - 실시간 동기화 (선택사항)

---

## 🎨 UI/UX 설계

### 1. 레이아웃

```
┌─────────────────────────────────────────────────────┐
│ [Toolbar: New, Open, Save, Export, Run]           │
├─────┬───────────────────────────────────────┬──────┤
│     │                                       │      │
│ 팔  │         3D 뷰포트 (메인)              │ 속   │
│ 레  │                                       │ 성   │
│ 트  │                                       │ 패   │
│     │                                       │ 널   │
│ [   │                                       │      │
│ 나무│                                       │ X: 5 │
│ 바위│                                       │ Y: 0 │
│ 건물│                                       │ Z: 3 │
│ ...]│                                       │      │
│     │                                       │      │
├─────┴───────────────────────────────────────┴──────┤
│ [Status Bar: Grid: ON | Snap: 1.0 | Camera: Top]  │
└─────────────────────────────────────────────────────┘
```

### 2. 팔레트 패널

- **카테고리 탭**: 자연, 건물, 장식, 상호작용
- **오브젝트 그리드**: 아이콘 + 이름
- **검색 바**: 오브젝트 검색
- **즐겨찾기**: 자주 사용하는 오브젝트

### 3. 속성 패널

- **기본 속성**
  - 위치 (X, Y, Z)
  - 회전 (X, Y, Z)
  - 스케일 (X, Y, Z)
  - 타입/이름

- **고급 속성**
  - 충돌 설정
  - 상호작용 설정
  - 채집 가능 여부
  - 커스텀 속성

### 4. 툴바

- **파일**
  - 새 맵
  - 열기
  - 저장
  - 내보내기

- **편집**
  - 실행 취소 (Undo)
  - 다시 실행 (Redo)
  - 복사/붙여넣기
  - 삭제

- **뷰**
  - 그리드 표시/숨김
  - 미니맵 표시/숨김
  - 카메라 모드 전환

- **도구**
  - 선택 도구
  - 배치 도구
  - 이동 도구
  - 회전 도구
  - 삭제 도구

---

## 🚀 구현 단계

### Phase 1: 기본 구조 (1-2주)

1. **프로젝트 설정**
   - 맵 에디터 디렉토리 생성
   - Vite + TypeScript 설정
   - Babylon.js 통합

2. **기본 씬 구성**
   - 3D 뷰포트 구현
   - 기본 카메라 컨트롤
   - 그리드 시스템

3. **간단한 배치 기능**
   - 오브젝트 팔레트 (하드코딩)
   - 클릭으로 배치
   - 기본 선택 및 삭제

### Phase 2: 편집 도구 (2-3주)

1. **선택 시스템**
   - 단일/다중 선택
   - 선택 하이라이트

2. **이동/회전/스케일**
   - Transform gizmo (선택 오브젝트 조작)
   - 스냅 기능

3. **타일 편집**
   - 타일 브러시
   - 타일 종류 변경

### Phase 3: 맵 관리 (1주)

1. **맵 데이터 구조**
   - JSON 스키마 정의
   - 직렬화/역직렬화

2. **저장/로드**
   - 파일 시스템 API 또는 다운로드
   - 맵 목록 UI

### Phase 4: 고급 기능 (2-3주)

1. **레이어 시스템**
   - 레이어 패널
   - 레이어 표시/숨김

2. **미니맵**
   - 미니맵 렌더링
   - 클릭으로 이동

3. **게임 통합**
   - 맵 로더 구현 (게임)
   - 미리보기 실행

### Phase 5: 폴리싱 (1-2주)

1. **UI 개선**
   - 디자인 시스템
   - 애니메이션

2. **성능 최적화**
   - 대용량 맵 처리
   - LOD 시스템

3. **사용자 편의 기능**
   - 단축키
   - 컨텍스트 메뉴
   - 히스토리 (Undo/Redo)

---

## 💡 기술 스택 제안

### 옵션 1: 순수 TypeScript + Babylon.js (추천)
- **장점**: 가볍고, 기존 게임과 동일한 엔진
- **단점**: UI 구현이 조금 더 수동적

### 옵션 2: React + Babylon.js
- **장점**: 풍부한 UI 라이브러리, 상태 관리 용이
- **단점**: 번들 크기 증가, 학습 곡선

### 옵션 3: Vue + Babylon.js
- **장점**: 가볍고 직관적
- **단점**: React보다 생태계 작음

---

## 📝 추가 고려사항

### 1. 성능
- 대용량 맵 (100x100 이상) 처리
- 오브젝트 인스턴싱
- 프러스텀 컬링

### 2. 확장성
- 플러그인 시스템 (향후)
- 커스텀 오브젝트 추가
- 스크립팅 지원 (선택)

### 3. 협업
- 맵 버전 관리 (Git 통합?)
- 맵 공유 기능 (미래)

---

## 🎯 최종 목표

1. **사용자 친화적**: 직관적인 UI로 누구나 사용 가능
2. **효율적**: 빠른 맵 제작
3. **유연성**: 다양한 맵 스타일 지원
4. **통합**: 게임과 완벽한 통합

---

이 구성안을 기반으로 단계적으로 구현을 시작할 수 있습니다. 어떤 부분부터 시작하고 싶으신가요?
