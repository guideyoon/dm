# 건설 시스템 기획 문서

## 📋 개요
플레이어가 마을에 다양한 건물을 건설하고 관리할 수 있는 시스템입니다.

## 🎯 핵심 기능

### 1. 건설 모드
- **진입 방법**: 좌측 메뉴바에서 "건설" 버튼 클릭
- **모드 상태**: 건설 모드 활성화 시 플레이어 이동 제한 (선택사항)
- **종료 방법**: ESC 키 또는 건설 패널의 "닫기" 버튼

### 2. 건물 선택
- **건물 목록**: 10가지 건물 타입 제공
  - 집 (house)
  - 상점 (shop)
  - 박물관 (museum)
  - 작업실 (workshop)
  - 창고 (storage)
  - 농장 (farm)
  - 헛간 (barn)
  - 온실 (greenhouse)
  - 우물 (well)
  - 울타리 (fence)
- **건물 정보 표시**:
  - 건물 이름
  - 크기 (가로 x 세로 x 높이)
  - 필요 재료 목록
  - 필요 코인
  - 건설 가능 여부 (재료/코인 부족 시 표시)

### 3. 건물 미리보기
- **시각적 피드백**:
  - 반투명 시안색 박스로 건물 크기 표시
  - 마우스 위치에 따라 미리보기 위치 업데이트
  - 건설 가능 위치: 녹색 테두리
  - 건설 불가 위치: 빨간색 테두리 (다른 건물과 겹침)
- **회전 기능**: R 키로 90도씩 회전 (0°, 90°, 180°, 270°)

### 4. 건물 배치
- **배치 방법**: 마우스 왼쪽 클릭
- **배치 조건**:
  - 재료 및 코인 충족
  - 다른 건물과 겹치지 않음
  - 최소 간격 0.5m 유지
- **배치 결과**:
  - 재료 및 코인 자동 소비
  - 건물 메시 생성
  - 건물 목록에 추가
  - 저장 시스템에 반영

### 5. 건물 관리
- **건물 선택**: 건설된 건물 클릭
- **건물 정보 표시**: 이름, 타입, 위치, 건설 날짜
- **건물 제거**: 우클릭 또는 삭제 버튼 (재료 반환 없음)
- **건물 이동**: 드래그 앤 드롭 (선택사항)

### 6. 건물 내부 입장
- **입장 방법**: 건물 앞에서 상호작용 (E 키 또는 클릭)
- **내부 기능**: BuildingInteriorSystem과 연동
  - 가구 배치
  - 벽지/바닥재 변경
  - 인테리어 평가

## 🎨 UI 구성

### 건설 패널 (BuildingPanel)
```
┌─────────────────────────────┐
│  건설 모드                    │
├─────────────────────────────┤
│ [건물 목록]                   │
│ ┌─────┐ ┌─────┐ ┌─────┐      │
│ │ 집  │ │상점 │ │박물관│      │
│ └─────┘ └─────┘ └─────┘      │
│ ┌─────┐ ┌─────┐ ┌─────┐      │
│ │작업실│ │창고 │ │농장 │      │
│ └─────┘ └─────┘ └─────┘      │
│ ...                          │
├─────────────────────────────┤
│ 선택된 건물: 집               │
│ 크기: 4m x 4m x 3m          │
│ 필요 재료:                   │
│   - 나무 x50                 │
│   - 돌 x30                   │
│ 필요 코인: 1,000             │
│ [건설 가능] / [재료 부족]     │
├─────────────────────────────┤
│ 조작법:                      │
│ - 마우스: 위치 선택           │
│ - R 키: 회전 (90도)          │
│ - 좌클릭: 배치                │
│ - ESC: 모드 종료             │
├─────────────────────────────┤
│ [닫기]                       │
└─────────────────────────────┘
```

## 🔧 기술 구현

### 1. 건설 모드 상태 관리
```typescript
interface BuildingModeState {
  isActive: boolean
  selectedBuildingType: BuildingType | null
  previewMesh: Mesh | null
  rotation: number // 0, 90, 180, 270 (도)
  canPlace: boolean
}
```

### 2. 미리보기 시스템
- `BuildingSystem.createPreviewMesh()` 사용
- 마우스 레이캐스팅으로 지면 위치 계산
- 매 프레임 업데이트
- 건설 가능 여부에 따라 색상 변경

### 3. 배치 시스템
- `BuildingSystem.buildBuilding()` 호출
- 재료/코인 확인
- 겹침 체크
- 메시 생성 및 등록

### 4. 저장/로드
- `SaveSystem`에 건물 데이터 포함
- 건물 ID, 타입, 위치, 회전 저장
- 로드 시 건물 메시 재생성

## 📝 사용자 경험 개선

### 1. 시각적 피드백
- 건설 가능: 녹색 테두리 + 반투명 시안색
- 건설 불가: 빨간색 테두리 + 반투명 빨간색
- 건물 크기 그리드 표시 (선택사항)

### 2. 오디오 피드백
- 건설 성공: 건설 사운드
- 건설 실패: 경고 사운드
- 회전: 회전 사운드

### 3. 키보드 단축키
- `R`: 건물 회전 (90도)
- `ESC`: 건설 모드 종료
- `1-9`: 건물 빠른 선택 (선택사항)

## 🎮 게임플레이 흐름

1. **건설 모드 진입**
   - 좌측 메뉴바에서 "건설" 클릭
   - 건설 패널 열림

2. **건물 선택**
   - 건물 목록에서 원하는 건물 클릭
   - 건물 정보 확인 (재료, 코인)

3. **위치 선택**
   - 마우스를 움직여 건물 위치 확인
   - 미리보기로 크기 및 위치 확인
   - R 키로 회전 조정

4. **건물 배치**
   - 원하는 위치에서 좌클릭
   - 재료/코인 확인 후 건설
   - 성공 시 건물 생성

5. **건물 관리**
   - 건물 클릭으로 정보 확인
   - 우클릭으로 제거 (선택사항)
   - 건물 앞에서 E 키로 입장

6. **건설 모드 종료**
   - ESC 키 또는 닫기 버튼
   - 일반 게임 모드로 복귀

## 🔄 향후 개선 사항

1. **건물 업그레이드**
   - 건물 레벨 시스템
   - 기능 확장 (예: 상점 확장 시 더 많은 아이템 판매)

2. **건물 커스터마이징**
   - 외관 색상 변경
   - 장식 추가

3. **건물 기능**
   - 각 건물별 고유 기능
   - 예: 창고 - 인벤토리 확장, 작업실 - 제작 속도 증가

4. **건물 연결**
   - 도로 시스템
   - 건물 간 연결 (예: 농장-헛간)

5. **건물 애니메이션**
   - 건설 애니메이션 (점진적 건설)
   - 건물 내부 입장 애니메이션
